<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Contact Form</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="styles.css"/>
</head>

<body>
<div class="wrapper">
    <header>CANARA EASY FEE</header>

    <form id="applicationForm">
        <h2>Inward Application</h2>

        <!-- New or Existing Customer -->
        <div class="form-section">
            <label for="customerType">New or Existing Customer:</label>
            <select id="customerType" name="customerType" class="styled-input"
                    onchange="toggleAccountNumberField()">
                <option value="New">New Customer</option>
                <option value="Existing">Existing Customer</option>
            </select>
        </div>

        <!-- Account Number (visible when "Existing Customer" is selected) -->
        <div class="form-section" id="accountNumberSection" style="display:none;">
            <label for="accountNumber">Account Number:</label>
            <input type="text" id="accountNumber" name="accountNumber" class="styled-input"/>
        </div>

        <label for="schoolName">1. Name of School/College:</label>
        <input type="text" id="schoolName" name="schoolName" required/>

        <label for="tradingName">2.Constitution of applicant:</label>
        <input type="text" id="trading" name="tradingName"/>

        <label for="address">3. Address of Institution:</label>
        <textarea id="address" name="address" required></textarea>

        <!-- Add more fields for Contact Details, Website, Date of Incorporation, PAN, etc. -->

        <!-- 4. Number of Years of Existence -->
        <label for="yearsOfExistence">4. Number of Years of Existence:</label>
        <input type="number" id="yearsOfExistence" name="yearsOfExistence"/>

        <!-- 5. GST Number -->
        <label for="gstNumber">5. GST Number (if available):</label>
        <input type="text" id="gstNumber" name="gstNumber"/>

        <!-- 6. Number of Students Enrolled at Present -->
        <label for="studentsEnrolled">6. Number of Students Enrolled at Present:</label>
        <input type="number" id="studentsEnrolled" name="studentsEnrolled"/>

        <!-- 7. Frequency of Fees/Transaction -->
        <label for="feeFrequency">7. Frequency of Fees/Transaction:</label>
        <select id="feeFrequency" name="feeFrequency">
            <option value="Monthly">Monthly</option>
            <option value="Quarterly">Quarterly</option>
            <option value="HalfYearly">Half Yearly</option>
            <option value="Yearly">Yearly</option>
        </select>

        <!-- 8. Present Arrangement of Fees -->
        <label for="feeArrangement">8. Present Arrangement of Fees:</label>
        <textarea id="feeArrangement" name="feeArrangement"></textarea>

        <h3>9. Existing Business</h3>

        <!-- Subheading Boxes -->
        <label for="avgCasa">a. Avg CASA (In Lakhs):</label>
        <input type="text" id="avgCasa" name="avgCasa"/>
        <label for="deposit">b. Deposit (In Lakhs):</label>
        <input type="text" id="deposit" name="deposit"/>
        <label for="advances">c. Advances (In Lakhs):</label>
        <input type="text" id="advances" name="advances"/>
        <label for="others1">d. Others (In Lakhs):</label>
        <input type="text" id="others1" name="others1"/>

        <h3>10. Additional Business</h3>

        <!-- Subheading Boxes -->
        <label for="avgCasaAdditional">a. Avg CASA (In Lakhs):</label>
        <input type="text" id="avgCasaAdditional" name="avgCasaAdditional"/>
        <label for="depositAdditional">b. Deposit (In Lakhs):</label>
        <input type="text" id="depositAdditional" name="depositAdditional"/>
        <label for="advancesAdditional">c. Advances (In Lakhs):</label>
        <input type="text" id="advancesAdditional" name="advancesAdditional"/>
        <label for="others2">d. Others (In Lakhs):</label>
        <input type="text" id="others2" name="others2"/>

        <!-- 5. Number of Expected New Enrollments -->
        <div class="form-section">
            <label for="expectedEnrollments">11. Number of Expected New Enrollments:</label>
            <input type="number" id="expectedEnrollments" name="expectedEnrollments" class="styled-input"/>
        </div>

        <!-- 6. Approximate Fee Collection during this FY -->
        <div class="form-section">
            <label for="feeCollection">12. Approximate Fee Collection during this FY(In Lakhs):</label>
            <input type="text" id="feeCollection" name="feeCollection" class="styled-input"/>
        </div>

        <!-- 6. Whether requested for waiver or concession -->
        <div class="form-section">
            <label for="waiverRequested">13. Whether requested for waiver or concession:</label>
            <select id="waiverRequested" name="waiverRequested" class="styled-input">
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select>
        </div>

        <!-- 7. If yes, percentage of waiver requested -->
        <div class="form-section">
            <label for="waiverPercentage">14. If yes, percentage of waiver requested:</label>
            <input type="number" id="waiverPercentage" name="waiverPercentage" class="styled-input"/>
        </div>

        <!-- 8. Expected salary accounts of staff -->
        <div class="form-section">
            <label for="salaryAccounts">15. Expected No. of salary accounts of staff:</label>
            <input type="text" id="salaryAccounts" name="salaryAccounts" class="styled-input"/>
        </div>

        <!-- 9. CIC Risk Grade-->
   <label for="cicScore">7.CIC Risk Grade:</label>
        <select id="cicScore" name="cicScore">
            <option value="Low">Low</option>
            <option value="Normal">Normal</option>
            <option value="Moderate">Moderate</option>
            <option value="High">High</option>
        </select>
        




        <!-- 10. Rating score for Waiver -->
        <div class="form-section">
            <label for="waiverRating">17. Rating score for Waiver:</label>
            <input type="number" id="waiverRating" name="waiverRating" class="styled-input"/>
        </div>
        
        
        

<h4>18. Risk Mitigation Measures : Check List</h4>
<table>
   <tr><td><strong>Details</strong></td><td><strong>Checkbox</strong></td></tr>
    <tr>
        <td>
            <div class="form-section">
                <label for="Risk1">a. The Nature of Business of the customer for which the Payment Gateway Facility is sought should be thoroughly studied to ensure that the Requirement matches the Business Needs. :</label>
           </td><td>     <select id="Risk1" name="Risk1" >
<option value="Complied">Complied </option>
<option value="Not Complied">Not Complied</option>

            </div>
    </td>
    </tr>
    <tr>
        <td>
            <div class="form-section">
                <label for="Risk2">b. The Applicant Merchant should have a Current Account (SB account allowed only in exceptional cases) or running accounts like OD/OCC accounts with the Bank and the Settlement will be credited to the said account. </label>
                 </td><td>     <select id="Risk2" name="Risk2" >
<option value="Complied">Complied </option>
<option value="Not Complied">Not Complied</option>

            </div>
        </td>
    </tr>
    <tr>
        <td>
            <div class="form-section">
                <label for="Risk3">c. Merchant should have satisfactory dealing with our branch for a minimum period of one year. Where the applicant merchant is new, the Circle Head is empowered to permit the recommendation of the merchant on specific recommendations of the branch in-charge, justifying the proposal.  </label>
              </td><td>     <select id="Risk3" name="Risk3" >
<option value="Complied">Complied </option>
<option value="Not Complied">Not Complied</option>

            </div>
        </td>
    </tr>
    <tr>
        <td>
            <div class="form-section">
                 </td><td>     <select id="Risk4" name="Risk4" >
<option value="Complied">Complied </option>
<option value="Not Complied">Not Complied</option>

            </div>
        </td>
    </tr>
    <tr>
        <td>
            <div class="form-section">
                <label for="Risk5">e. KYC to be verified </label>
             </td><td>     <select id="Risk5" name="Risk5" >
<option value="Complied">Complied </option>
<option value="Not Complied">Not Complied</option>

            </div>
        </td>
    </tr>
    <tr>
        <td>
            <div class="form-section">
                <label for="Risk6">f. Branches shall obtain the following documents while enrolling merchants, in case Branch has not collected these documents, from the existing customer, for any other purpose:  Business license/registration copy (any of the following): 
                    * GST registration 
                    * Municipal Corporation Registration 
                    * Others Government Registration (e.g. issued under the shops & establishment Act, etc.) 
                    * Certified IT Returns or Certified Advance Tax 
                    * Challan or Certified Professional Tax Return 
                    * application form for a government license acknowledged by the authority containing merchant name and address and a receipt of payment to the authority.
                </label>
             </td><td>     <select id="Risk6" name="Risk6" >
<option value="Complied">Complied </option>
<option value="Not Complied">Not Complied</option>

            </div>
        </td>
    </tr>
    <tr>
        <td>
            <div class="form-section">
                <label for="Risk7">g. CIC SCORE: Branches shall draw CIR from CIC before recommending a merchant, and CIC Rating should be low/normal risk. </label>
                </td><td>     <select id="Risk7" name="Risk7" >
<option value="Complied">Complied </option>
<option value="Not Complied">Not Complied</option>

            </div>
        </td>
    </tr>
    <tr>
        <td>
            <div class="form-section">
                <label for="Risk8">h. Circle office invariably shall verify the “negative verification report from VISA/MASTER network & NPCI” (available online) before recommending the merchant’s name are not found in the list.</label>
                   </td><td>     <select id="Risk8" name="Risk8" >
<option value="Complied">Complied </option>
<option value="Not Complied">Not Complied</option>

            </div>
        </td>
    </tr>
    <tr>
        <td>
            <div class="form-section">
                <label for="Risk9">i. While recommending for the usage of International Cards for accepting donations from foreign countries, Branches/Regional Office/Circle Offices to ensure that the concerned merchant has complied with the requirement of FEMA regulations like obtaining foreign contribution regulation act, 2010 (FCRA) registration number from the ministry of home affairs, GOI and ensuring the validity/periodical renewal of the same. All the precautions applicable for cross-border remittances to be taken. </label>
                  </td><td>     <select id="Risk9" name="Risk9" >
<option value="Complied">Complied </option>
<option value="Not Complied">Not Complied</option>

            </div>
        </td>
    </tr>
    <tr>
        <td>
            <div class="form-section">
                <label for="Risk10">j. Utmost care to be taken before recommending a facility to the accounts like TRUST accounts. For example, Branches/Regional offices/Circle Offices to ensure that the trust deed having the specific clause permitting the online collection facility and are a solution to that effect is passed, etc. </label>
                   </td><td>     <select id="Risk10" name="Risk10" >
<option value="Complied">Complied </option>
<option value="Not Complied">Not Complied</option>

            </div>
        </td>
    </tr>
    <tr>
        <td>
            <div class="form-section">
                <label for="Risk11">k. In certain cases, as per the recommendations received from the circle office, merchants are not ready to enter into a Tripartite agreement with the aggregator, merchants will be willing to enter into an agreement with the bank only. In such cases, the bank has to enter into an agreement with the aggregator and enter back-to-back agreement with the merchant covering all the terms and conditions of the aggregator suitably. Such facilities to be recommended only in exceptional cases for high valued customers basing on the business support and benefits derived from the account. </label>
                  </td><td>     <select id="Risk11" name="Risk1" >
<option value="Complied">Complied </option>
<option value="Not Complied">Not Complied</option>

            </div>
        </td>
    </tr>
</table>


<h5> 19.Declaration: </h5>

        <!-- 11. Whether application has been submitted in full -->
        <div class="form-section">
            <input type="checkbox" id="applicationSubmitted" name="applicationSubmitted" class="styled-input"required/>
     
            <label for="applicationSubmitted">We hereby confirm that we have completed and thoroughly reviewed the application, along with the necessary documents, in accordance with the latest Payment Gateway policy.</label>
               </div>

        <!-- Add more fields for other services -->
        <label for="fileInput">Upload Supporting Document:</label>
        <input type="file" id="fileInput" name="supportingDocument"/>
        <button type="submit">Submit</button>
    </form>
</div>

<script src="https://www.gstatic.com/firebasejs/3.7.4/firebase.js"></script>

<script>
    // Firebase initialization
    const firebaseConfig = {
        apiKey: "AIzaSyA7XRIIWZaWoK1dNVtaaTBCna4nqDszW00",
        authDomain: "hord1-11455.firebaseapp.com",
        databaseURL: "https://hord1-11455-default-rtdb.firebaseio.com",
        projectId: "hord1-11455",
        storageBucket: "hord1-11455.appspot.com",
        messagingSenderId: "793882034504",
        appId: "1:793882034504:web:425d20c508ee426360f37d",
        measurementId: "G-YS99WT22ZH",
    };

    firebase.initializeApp(firebaseConfig);

    // Reference to the Firebase database for storing form data
    const messagesRef = firebase.database().ref('Institution Data');

    // Event listener for form submission
    document.getElementById('applicationForm').addEventListener('submit', submitForm);

    // Function to handle form submission
    function submitForm(e) {
        e.preventDefault();

        // Get form input values
        const schoolName = getInputVal('schoolName');
        const accountNumber = getInputVal('accountNumber');
        const tradingName = getInputVal('accountNumber');
        const address = getInputVal('address');
        const yearsOfExistence = getInputVal('yearsOfExistence');
        const gstNumber = getInputVal('gstNumber');
        const studentsEnrolled = getInputVal('studentsEnrolled');
        const feeFrequency = getInputVal('feeFrequency');
        const feeArrangement = getInputVal('feeArrangement');
        const avgCasa = getInputVal('avgCasa');
        const deposit = getInputVal('deposit');
        const advances = getInputVal('advances');
        const others1 = getInputVal('others1');
        const avgCasaAdditional = getInputVal('avgCasaAdditional');
        const depositAdditional = getInputVal('depositAdditional');
        const advancesAdditional = getInputVal('advancesAdditional');
        const others2 = getInputVal('others2');
        const expectedEnrollments = getInputVal('expectedEnrollments');
        const feeCollection = getInputVal('feeCollection');
        const waiverRequested = getInputVal('waiverRequested');
        const waiverPercentage = getInputVal('waiverPercentage');
        const cicScore = getInputVal('cicScore');
        const salaryAccounts = getInputVal('salaryAccounts');
        const waiverRating = getInputVal('waiverRating');
        const Risk1 = getInputVal('Risk1');
        const Risk2 = getInputVal('Risk2');
        const Risk3 = getInputVal('Risk3');
        const Risk4 = getInputVal('Risk4');
        const Risk5 = getInputVal('Risk5');
        const Risk6 = getInputVal('Risk6');
        const Risk7 = getInputVal('Risk7');
        const Risk8 = getInputVal('Risk8');
        const Risk9 = getInputVal('Risk9');
        const Risk10 = getInputVal('Risk10');
        const Risk11= getInputVal('Risk11');
        const applicationSubmitted = document.getElementById('applicationSubmitted').checked;

        // Get the file input element and the file
        const fileInput = document.getElementById('fileInput');
        const supportingDocument = fileInput.files[0];

        // Check if a file is selected
        if (supportingDocument) {
            // Check if the file size is less than 5MB
            if (supportingDocument.size <= 5 * 1024 * 1024) {
                // Generate a unique application number
                const applicationNumber = generateApplicationNumber();

                // Save form data to the Firebase database
                saveMessage(
                    schoolName,
                    accountNumber,
                    tradingName,
                    address,
                    yearsOfExistence,
                    gstNumber,
                    studentsEnrolled,
                    feeFrequency,
                    feeArrangement,
                    avgCasa,
                    deposit,
                    advances,
                    others1,
                    avgCasaAdditional,
                    depositAdditional,
                    advancesAdditional,
                    others2,
                    expectedEnrollments,
                    feeCollection,
                    waiverRequested,
                    waiverPercentage,
                    cicScore,
                    salaryAccounts,
                    waiverRating,
                    Risk1,
                     Risk2,
                    Risk3,
                    Risk4,
                    Risk5,
                    Risk6,
                    Risk7,
                    Risk8,
                    Risk9,
                    Risk10,
                    Risk11,
                    applicationNumber,
                    applicationSubmitted
                );

                // Save the file to Firebase Storage
                saveFileToStorage(supportingDocument, applicationNumber);

                // Display success message with application number
                alert('Successfully submitted! Your application number is: ' + applicationNumber);

                // Reset the form after submission
                document.getElementById('applicationForm').reset();
            } else {
                // Display error message for exceeding file size limit
                alert('Error: The selected file exceeds the maximum size of 5MB.');
            }
        } else {
            // Display error message for not selecting a file
            alert('Error: Please select a PDF file.');
        }
    }

    // Function to generate a unique application number
    function generateApplicationNumber() {
        return 'APP' + Math.floor(Math.random() * 10000);
    }

    // Function to get input values by element ID
    function getInputVal(id) {
        return document.getElementById(id).value;
    }

    // Function to save form data to the Firebase database
    function saveMessage(
        schoolName,
        accountNumber,
        tradingName,
        address,
        yearsOfExistence,
        gstNumber,
        studentsEnrolled,
        feeFrequency,
        feeArrangement,
        avgCasa,
        deposit,
        advances,
        others1,
        avgCasaAdditional,
        depositAdditional,
        advancesAdditional,
        others2,
        expectedEnrollments,
        feeCollection,
        waiverRequested,
        waiverPercentage,
        cicScore,
        salaryAccounts,
        waiverRating,
        Risk1,
         Risk2,
        Risk3,
        Risk4,
        Risk5,
        Risk6,
        Risk7,
        Risk8,
        Risk9,
        Risk10,
        Risk11,
        applicationNumber,
        applicationSubmitted
    ) {
        const newMessageRef = messagesRef.push();
        newMessageRef.set({
            schoolName: schoolName,
            accountNumber: accountNumber,
            tradingName: tradingName,
            address: address,
            yearsOfExistence: yearsOfExistence,
            gstNumber: gstNumber,
            studentsEnrolled: studentsEnrolled,
            feeFrequency: feeFrequency,
            feeArrangement: feeArrangement,
            avgCasa: avgCasa,
            deposit: deposit,
            advances: advances,
            others1: others1,
            avgCasaAdditional: avgCasaAdditional,
            depositAdditional: depositAdditional,
            advancesAdditional: advancesAdditional,
            others2: others2,
            expectedEnrollments: expectedEnrollments,
            feeCollection: feeCollection,
            waiverRequested: waiverRequested,
            waiverPercentage: waiverPercentage,
            cicScore: cicScore,
            salaryAccounts: salaryAccounts,
            waiverRating: waiverRating,
            Risk1 : Risk1,
            Risk2:Risk2,
            Risk3:Risk3,
            Risk4:Risk4,
            Risk5:Risk5,
            Risk6:Risk6,
            Risk7:Risk7,
            Risk8:Risk8,
            Risk9:Risk9,
            Risk10:Risk10,
            Risk11:Risk11,
            applicationNumber: applicationNumber,
            applicationSubmitted: applicationSubmitted,
        });
    }

    // Function to save the file to Firebase Storage and update the database
    function saveFileToStorage(file, applicationNumber) {
        const storageRef = firebase.storage().ref();
        const fileRef = storageRef.child('supportingDocuments/' + applicationNumber + '/' + file.name);

        fileRef.put(file).then(function (snapshot) {
            console.log('File uploaded successfully:', snapshot);

            // Get the file name
            const fileName = file.name;

            // Get the download URL of the uploaded file
            fileRef.getDownloadURL().then(function (downloadURL) {
                console.log('File download URL:', downloadURL);

                // Now you can update the database with the file details
                updateDatabaseWithFileDetails(applicationNumber, fileName, downloadURL);
            }).catch(function (error) {
                console.error('Error getting download URL:', error);
            });
        }).catch(function (error) {
            console.error('Error uploading file:', error);
        });
    }

    // Function to update the database with the file name and file download URL
    function updateDatabaseWithFileDetails(applicationNumber, fileName, fileDownloadURL) {
        const messagesRef = firebase.database().ref('Institution Data');
        const applicationRef = messagesRef.child(applicationNumber);

        // Update the 'fileName' and 'fileDownloadURL' properties in the database
        applicationRef.update({
            fileName: fileName,
            fileDownloadURL: fileDownloadURL
        });

        console.log('File name and download URL added to the database:', fileName, fileDownloadURL);
    }
</script>
</body>
</html>




<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>CANARA EASY FEE</header>
  <div class="wrapper">
    <div class="form-container" id="applicationListContainer">
      <!-- Table content will be added dynamically -->
    </div>

    <script src="https://www.gstatic.com/firebasejs/3.7.4/firebase.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyA7XRIIWZaWoK1dNVtaaTBCna4nqDszW00",
        authDomain: "hord1-11455.firebaseapp.com",
        databaseURL: "https://hord1-11455-default-rtdb.firebaseio.com",
        projectId: "hord1-11455",
        storageBucket: "hord1-11455.appspot.com",
        messagingSenderId: "793882034504",
        appId: "1:793882034504:web:425d20c508ee426360f37d",
        measurementId: "G-YS99WT22ZH"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      // Reference to the 'Institution Form' node in the database
      var database = firebase.database().ref().child('Institution Data');

      // Fetch data from Firebase and populate the table
      database.once('value', function(snapshot){
        if(snapshot.exists()){
          var tableContent = '<table>';
          tableContent += '<tr><th>Application Number</th><th>Institution Name</th><th>Action</th></tr>';

          snapshot.forEach(function(data){
            var applicationNumber = data.val().applicationNumber;
            var schoolName = data.val().schoolName;

            // Check if applicationNumber and schoolName are defined
            if (applicationNumber && schoolName) {
              // Build the table row dynamically
              tableContent += '<tr>';
              tableContent += '<td>' + applicationNumber + '</td>';
              tableContent += '<td>' + schoolName + '</td>';
              tableContent += '<td><button onclick="viewDetails(\'' + applicationNumber + '\', \'' + schoolName + '\')">View</button></td>';
              tableContent += '</tr>';
            }
          });

          tableContent += '</table>';

          // Append the table content to the form container
          $('.form-container').html(tableContent);
        }
      });

      // Function to handle the "View" button click
      function viewDetails(applicationNumber, schoolName) {
        // Retrieve the details based on applicationNumber and schoolName
        var detailsRef = firebase.database().ref().child('Institution Data').orderByChild('applicationNumber').equalTo(applicationNumber);

        detailsRef.once('value', function(detailsSnapshot) {
          if (detailsSnapshot.exists()) {
            var details = detailsSnapshot.val();


            // Hide the existing table content
            $('.form-container').html('');

            // Extract details from the snapshot
           // Extract the address and yearsOfExistence from details
            var address = details[Object.keys(details)[0]].address;
            var yearsOfExistence = details[Object.keys(details)[0]].yearsOfExistence;
            var gstNumber = details[Object.keys(details)[0]].gstNumber;
            var studentsEnrolled = details[Object.keys(details)[0]].studentsEnrolled;
var feeFrequency = details[Object.keys(details)[0]].feeFrequency;
var feeArrangement = details[Object.keys(details)[0]].feeArrangement;
var avgCasa = details[Object.keys(details)[0]].avgCasa;
var deposit = details[Object.keys(details)[0]].deposit;
var advances = details[Object.keys(details)[0]].advances;
var others1 = details[Object.keys(details)[0]].others1;
var avgCasaAdditional = details[Object.keys(details)[0]].avgCasaAdditional;
var depositAdditional = details[Object.keys(details)[0]].depositAdditional;
var advancesAdditional = details[Object.keys(details)[0]].advancesAdditional;
var others2 = details[Object.keys(details)[0]].others2;
var expectedEnrollments = details[Object.keys(details)[0]].expectedEnrollments;
var feeCollection = details[Object.keys(details)[0]].feeCollection;
var waiverRequested = details[Object.keys(details)[0]].waiverRequested;
var cicScore = details[Object.keys(details)[0]].cicScore;
var salaryAccounts = details[Object.keys(details)[0]].salaryAccounts;
var waiverRating = details[Object.keys(details)[0]].waiverRating;
var Risk1 = details[Object.keys(details)[0]].Risk1;
var Risk2 = details[Object.keys(details)[0]].Risk2;
var Risk3 = details[Object.keys(details)[0]].Risk3;
var Risk4 = details[Object.keys(details)[0]].Risk4;
var Risk5 = details[Object.keys(details)[0]].Risk5;
var Risk6 = details[Object.keys(details)[0]].Risk6;
var Risk7 = details[Object.keys(details)[0]].Risk7;
var Risk8 = details[Object.keys(details)[0]].Risk8;
var Risk9 = details[Object.keys(details)[0]].Risk9;
var Risk10 = details[Object.keys(details)[0]].Risk10;
var Risk11 = details[Object.keys(details)[0]].Risk11;
var applicationNumber = details[Object.keys(details)[0]].applicationNumber;



          
          // Display the details in a table
var detailsContent = '<table>';
detailsContent += '<tr><td><strong>Application Number:</strong></td><td>' + applicationNumber + '</td></tr>';
detailsContent += '<tr><td><strong>Institution Name:</strong></td><td>' + schoolName + '</td></tr>';
detailsContent += '<tr><td><strong>Address:</strong></td><td>' + address + '</td></tr>';
detailsContent += '<tr><td><strong>Years of Existence:</strong></td><td>' + yearsOfExistence + '</td></tr>';
detailsContent += '<tr><td><strong>GST Number:</strong></td><td>' + gstNumber + '</td></tr>';
detailsContent += '<tr><td><strong>Students Enrolled:</strong></td><td>' + studentsEnrolled + '</td></tr>';
detailsContent += '<tr><td><strong>Fee Frequency:</strong></td><td>' + feeFrequency + '</td></tr>';
detailsContent += '<tr><td><strong>Fee Arrangement:</strong></td><td>' + feeArrangement + '</td></tr>';
detailsContent += '<tr><td><strong>Average CASA(In Lakhs):</strong></td><td>' + avgCasa + '</td></tr>';
detailsContent += '<tr><td><strong>Deposit(In Lakhs):</strong></td><td>' + deposit + '</td></tr>';
detailsContent += '<tr><td><strong>Advances(In Lakhs):</strong></td><td>' + advances + '</td></tr>';
detailsContent += '<tr><td><strong>Others (In Lakhs):</strong></td><td>' + others1 + '</td></tr>';
detailsContent += '<tr><td><strong>Average CASA Additional(In Lakhs):</strong></td><td>' + avgCasaAdditional + '</td></tr>';
detailsContent += '<tr><td><strong>Deposit Additional(In Lakhs):</strong></td><td>' + depositAdditional + '</td></tr>';
detailsContent += '<tr><td><strong>Advances Additional(In Lakhs):</strong></td><td>' + advancesAdditional + '</td></tr>';
detailsContent += '<tr><td><strong>Others (In Lakhs):</strong></td><td>' + others2 + '</td></tr>';
detailsContent += '<tr><td><strong>Expected Enrollments:</strong></td><td>' + expectedEnrollments + '</td></tr>';
detailsContent += '<tr><td><strong>Fee Collection(In Lakhs):</strong></td><td>' + feeCollection + '</td></tr>';
detailsContent += '<tr><td><strong>Waiver Requested:</strong></td><td>' + waiverRequested + '</td></tr>';
detailsContent += '<tr><td><strong>CIC Risk Grade </strong></td><td>' + cicScore + '</td></tr>';
detailsContent += '<tr><td><strong>Waiver Rating:</strong></td><td>' + waiverRating + '</td></tr>';
detailsContent += '<tr><td><strong>Expected No. of Salary Accounts :</strong></td><td> '+ salaryAccounts + '</td></tr>';
detailsContent += '</table>';

detailsContent += '<h2><strong>Risk Mitigation Measures - Checklist:</strong></h2>';



detailsContent += '<table border="1">';
detailsContent += '<tr><th>Risk Mitigation Measures</th><th>Compliance Status</th></tr>';
detailsContent += '<tr><td>b. The Applicant Merchant should have a Current Account...</td><td>' + (Risk2 === 'Complied' ? 'Complied' : 'Not Complied') + '</td></tr>';
detailsContent += '<tr><td>a. The Nature of Business of the customer for which the Payment Gateway Facility is sought should be thoroughly studied to ensure that the Requirement matches the Business Needs: <strong></td><td>' + (Risk1 === 'Complied' ? 'Complied' : 'Not Complied') + '</strong></td></tr>';            
detailsContent += '<tr><td>b. The Applicant Merchant should have a Current Account (SB account allowed only in exceptional cases) or running accounts like OD/OCC accounts with the Bank, and the Settlement will be credited to the said account: <strong></td><td>' + (Risk2 === 'Complied' ? 'Complied' : 'Not Complied') + '</strong></td></tr>';
detailsContent += '<tr><td>c. Merchant should have satisfactory dealing with our branch for a minimum period of one year. Where the applicant merchant is new, the Circle Head is empowered to permit the recommendation of the merchant on specific recommendations of the branch in-charge, justifying the proposal: <strong></td><td>' + (Risk3 === 'Complied' ? 'Complied' : 'Not Complied') + '</strong></td></tr>'; 
detailsContent += '<tr><td>d. In respect of High-Risk Merchants, the condition of satisfactory dealing with our bank for a minimum of one year is mandatory and cannot be relaxed: <strong></td><td>' + (Risk4 === 'Complied' ? 'Complied' : 'Not Complied') + '</strong></td></tr>'; 
detailsContent += '<tr><td>e. KYC to be verified: <strong></td><td>' + (Risk5 === 'Complied' ? 'Complied' : 'Not Complied') + '</strong></td></tr>'; 
detailsContent += '<tr><td>f. Branches shall obtain the following documents while enrolling merchants, in case Branch has not collected these documents from the existing customer for any other purpose: Business license/registration copy (any of the following): GST registration, Municipal Corporation Registration, Others Government Registration (e.g., issued under shops & establishment Act, etc.), Certified IT Returns or Certified Advance Tax Challan or Certified Professional Tax Return application form for a government license acknowledged by the authority containing merchant name and address and a receipt of payment to the authority: <strong></td><td>' + (Risk6 === 'Complied' ? 'Complied' : 'Not Complied') + '</strong></td></tr>'; 
detailsContent += '<tr><td>g.CIC SCORE: Branches shall draw CIR from CIC before recommending merchant and CIC Rating should be low/normal risk: <strong></td><td>' +(Risk7 === 'Complied' ? 'Complied' : 'Not Complied') + '</strong></td></tr>'; 
detailsContent += '<tr><td>h. Circle office invariably shall verify the “negative verification report from VISA/MASTER network & NPCI (available online) before recommending the merchant’s name are not found in the list: <strong></td><td>' + (Risk8 === 'Complied' ? 'Complied' : 'Not Complied') + '</strong></td></tr>'; 
detailsContent += '<tr><td>i. While recommending for usage of International Cards for accepting donations from foreign countries, Branches/Regional Office/Circle Offices to ensure that the concerned merchant has complied with the requirement of FEMA regulations like obtaining foreign contribution regulation act, 2010 (FCRA) registration number from the ministry of home affairs, GOI and ensuring the validity/periodical renewal of the same. All the precautions applicable for cross border remittances to be taken: <strong></td><td>' + (Risk9 === 'Complied' ? 'Complied' : 'Not Complied') + '</strong></td></tr>'; 
detailsContent += '<tr><td>j. Utmost care to be taken before recommending facility to the accounts like TRUST accounts. For example, Branches/Regional offices/Circle Offices to ensure that the trust deed having the specific clause permitting the online collection facility and are solution to that effect is passed etc.: <strong></td><td>' + (Risk10 === '' ? 'Complied' : 'Not Complied') + '</strong></td></tr>';
detailsContent += '<tr><td>k. In certain cases, as per the recommendations received from circle office, merchants are not ready to enter into Tripartite agreement with the aggregator, merchants will be willing to enter into agreement with the bank only. In such cases, the bank has to enter into an agreement with the aggregator and enter back-to-back agreement with the merchant covering all the terms and conditions of aggregator suitably. Such facilities to be recommended only in exceptional cases for high valued customers basing on the business support and benefits derived from the account: <strong></td><td>' + (Risk11 === 'Complied' ? 'Complied' : 'Not Complied') + '</strong></td></tr>';

detailsContent += '</table>';






detailsContent += '</br>';


            // Add "View Files" button
            detailsContent += '<p><strong>View:</strong> <a id="fileLink" href="javascript:void(0);" onclick="viewApplication(\'' + applicationNumber + '\')">View File</a></p>';

            // Recommendation and Remark input fields
            detailsContent += '<label for="recommendation">Recommendation: </label>';
            detailsContent += '<input type="text" id="recommendation" value="' + (details[Object.keys(details)[0]].recommendation || '') + '">'+'<br>';
            detailsContent += '<label for="remark">Remark: </label>';
            detailsContent += '<input type="text" id="remark" value="' + (details[Object.keys(details)[0]].remark || '') + '">'+'<br>';
            detailsContent += '<button onclick="updateDetails(\'' + applicationNumber + '\', \'' + schoolName + '\')">Update</button>';
            detailsContent += '</div>';

            // Append the details content to the form container
            $('.form-container').html(detailsContent);
          } else {
            // Application not found
            $('.form-container').html('<p>Application not found</p>');
          }
        });
      }
// Function to view the application and retrieve file URL
function viewApplication(applicationNumber) {
  // Check if the application number is provided
  if (applicationNumber) {
    // Reference to the Firebase database for retrieving file URLs
    var messagesRef = firebase.database().ref('Institution Data');

    // Retrieve file URL from the database
    messagesRef.child(applicationNumber).once('value').then(function(snapshot) {
      var fileURL = snapshot.val() ? snapshot.val().fileDownloadURL : null;
      var fileName = snapshot.val() ? snapshot.val().fileName : null;

      // Display the file URL
      if (fileURL) {
        // Open the file in a new tab or window
        window.open(fileURL, '_blank');
      } else {
        alert('File URL not found for the given application number.');
      }
    }).catch(function(error) {
      console.error('Error retrieving file URL:', error);
    });
  } else {
    alert('Please enter an application number.');
  }
}


      function updateDetails(applicationNumber, schoolName) {
        // Update details code...
      }
    </script>
        <script>  function updateDetails(applicationNumber, schoolName) {
  // Retrieve the updated recommendation and remark values
  var updatedRecommendation = $('#recommendation').val();
  var updatedRemark = $('#remark').val();

  // Update the details in Firebase Realtime Database
  var detailsRef = firebase.database().ref().child('Institution Data').orderByChild('applicationNumber').equalTo(applicationNumber);

  detailsRef.once('value', function (detailsSnapshot) {
    if (detailsSnapshot.exists()) {
      var detailsKey = Object.keys(detailsSnapshot.val())[0];
      
      // Update the recommendation and remark fields
      firebase.database().ref('Institution Data/' + detailsKey).update({
        recommendation: updatedRecommendation,
        remark: updatedRemark
      });// Display a success message or perform further actions as needed
      alert('Details updated successfully!');
    } else {
      // Application not found
      alert('Application not found');
    }
  });
}</script>
  </body>
</html>
